
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>StreamLinkSync â€” Live Links</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
<header class="bg-sky-700 text-white p-4 shadow">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-2xl font-semibold">StreamLinkSync â€” Live Links</h1>
    <p class="text-sm opacity-90">Lista automÃ¡tica de links m3u8 â€” atualiza a tabela <code>live_links</code>.</p>
  </div>
</header>
<main class="max-w-6xl mx-auto p-4">
  <div class="flex gap-3 mb-4">
    <input id="q" class="flex-1 p-2 border rounded" placeholder="Buscar canal..." />
    <select id="sort" class="p-2 border rounded">
      <option value="name">Ordenar: Nome</option>
      <option value="recent">Ordenar: Mais recentes</option>
    </select>
    <button id="refresh" class="px-4 py-2 bg-sky-700 text-white rounded">Atualizar lista</button>
    <button id="force" class="px-4 py-2 bg-green-600 text-white rounded">ForÃ§ar atualizaÃ§Ã£o</button>
  </div>
  <div id="status" class="text-sm text-slate-600 mb-3">Pronto.</div>
  <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</main>
<script>
const API_ROOT = '';
async function apiFetch(path, opts){ const res = await fetch(API_ROOT + path, opts); if(!res.ok) { const j = await res.json().catch(()=>({})); throw new Error(j.error || 'HTTP ' + res.status); } return res.json(); }
async function load(){ const st = document.getElementById('status'); st.textContent = 'Carregando...'; try{ const data = await apiFetch('/api/live/list'); render(data); st.textContent = data.length + ' registros'; } catch(e){ st.textContent = 'Erro: ' + e.message; } }
function render(items){ const q = document.getElementById('q').value.toLowerCase(); const sort = document.getElementById('sort').value; let filtered = items.filter(i => (i.name||'').toLowerCase().includes(q)); if(sort==='recent') filtered.sort((a,b)=> (b.last_updated||'').localeCompare(a.last_updated||'')); else filtered.sort((a,b)=> (a.name||'').localeCompare(b.name||'')); const grid = document.getElementById('grid'); grid.innerHTML=''; filtered.forEach(i=>{ const el = document.createElement('div'); el.className='bg-white rounded shadow p-4 flex flex-col gap-2'; el.innerHTML = `<div class="font-semibold">${i.name || 'Sem nome'}</div><div class="text-xs text-slate-500 truncate">${i.url || ''}</div><div class="text-xs text-slate-500">Atualizado: ${i.last_updated || ''}</div><div class="flex gap-2"><a class="px-3 py-1 bg-sky-600 text-white rounded" target="_blank" href="${i.url||'#'}">â–¶ Abrir</a><button class="px-3 py-1 border rounded" onclick="navigator.clipboard.writeText('${i.url||''}')">ðŸ“‹ Copiar</button></div>`; grid.appendChild(el); }); }
document.getElementById('q').addEventListener('input', load);
document.getElementById('sort').addEventListener('change', load);
document.getElementById('refresh').addEventListener('click', load);
document.getElementById('force').addEventListener('click', async ()=>{ if(!confirm('ForÃ§ar atualizaÃ§Ã£o agora?')) return; const st = document.getElementById('status'); st.textContent = 'Solicitando atualizaÃ§Ã£o...'; try{ const res = await fetch('/api/update',{ method: 'POST' }); const j = await res.json(); if(!res.ok) throw new Error(j.error||JSON.stringify(j)); st.textContent = 'Resultado: ' + (j.skipped ? 'Skipped â€” Ãºltima execuÃ§Ã£o <6h' : ('updated=' + j.updated + ', failed=' + j.failed)); setTimeout(load,2000); }catch(e){ st.textContent = 'Erro: ' + e.message; } });
load();
</script>
</body>
</html>
