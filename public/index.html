<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>StreamLinkSync</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
<header class="bg-sky-700 text-white p-4 shadow">
  <div class="max-w-5xl mx-auto flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-semibold">StreamLinkSync</h1>
      <p class="text-sm opacity-90">Atualiza links m3u8 (gate 6h) â€” force update com segredo</p>
    </div>
    <div class="flex gap-2">
      <button id="forceBtn" class="px-3 py-2 bg-green-500 rounded">ForÃ§ar atualizaÃ§Ã£o</button>
      <button id="refreshBtn" class="px-3 py-2 bg-white text-slate-700 border rounded">Atualizar lista</button>
    </div>
  </div>
</header>
<main class="max-w-5xl mx-auto p-4">
  <div class="mb-4 flex gap-2">
    <input id="q" placeholder="Buscar..." class="flex-1 p-2 border rounded"/>
    <select id="sort" class="p-2 border rounded">
      <option value="name">Ordenar por nome</option>
      <option value="date">Ordenar por data (mais recentes)</option>
    </select>
  </div>
  <div id="status" class="text-sm text-slate-600 mb-3">Pronto.</div>
  <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
</main>
<script>
const API_ROOT = '';
const statusEl = document.getElementById('status');
async function fetchList(){ statusEl.textContent='Carregando...'; try{ const res = await fetch(API_ROOT + '/api/live/list'); if(!res.ok) throw new Error('HTTP '+res.status); const data = await res.json(); return data; }catch(e){ statusEl.textContent='Erro ao carregar: '+e.message; return []; } }
function render(items){ const q = document.getElementById('q').value.toLowerCase(); const sort = document.getElementById('sort').value; let arr = items.filter(i => (i.name||'').toLowerCase().includes(q)); if(sort==='date'){ arr.sort((a,b)=> (b.last_updated||'').localeCompare(a.last_updated||'')); } else { arr.sort((a,b)=>(a.name||'').localeCompare(b.name||'')); } const grid = document.getElementById('grid'); grid.innerHTML=''; arr.forEach(it=>{ const el=document.createElement('div'); el.className='bg-white rounded shadow p-4 flex flex-col gap-2'; el.innerHTML = `<div class="font-semibold">${it.name||'Sem nome'}</div><div class="text-xs text-slate-500 truncate">${it.m3u8_url||''}</div><div class="text-xs text-slate-400">Atualizado: ${it.last_updated||''}</div><div class="flex gap-2 mt-2"><a class="px-3 py-1 bg-sky-600 text-white rounded" target="_blank" href="${it.m3u8_url||'#'}">â–¶ Abrir</a><button class="px-3 py-1 border rounded" onclick="navigator.clipboard.writeText('${it.m3u8_url||''}')">ðŸ“‹ Copiar</button></div>`; grid.appendChild(el); }); statusEl.textContent = arr.length + ' canais exibidos.'; }
document.getElementById('refreshBtn').addEventListener('click', async()=>{ const data = await fetchList(); render(data); });
document.getElementById('forceBtn').addEventListener('click', async()=>{ const secret = prompt('Insira o CRON_SECRET (nÃ£o serÃ¡ guardado)'); if(!secret) return alert('OperaÃ§Ã£o cancelada'); statusEl.textContent='Solicitando atualizaÃ§Ã£o...'; try{ const res = await fetch(API_ROOT + '/api/update', { method:'GET', headers:{ 'x-cron-key': secret } }); const json = await res.json(); if(!res.ok) throw new Error(JSON.stringify(json)); statusEl.textContent = 'AtualizaÃ§Ã£o solicitada. Resultado: ' + JSON.stringify(json); setTimeout(async()=>{ const data = await fetchList(); render(data); }, 4000); }catch(e){ statusEl.textContent = 'Erro: ' + e.message; } });
(async()=>{ const data = await fetchList(); render(data); })();
</script>
</body>
</html>